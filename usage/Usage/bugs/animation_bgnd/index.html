<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 for Linux version 5.6.0">
  <meta charset="utf-8">
  <meta name="viewport" content=
  "width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../../../html/www/css/magick.css">
  <title>Animation Bugs -- IM v6 Examples</title>
  <link rel="icon" href="../../img_www/favicon.ico" type=
  "image/x-icon">
  <link rel="shortcut" href="../../img_www/favicon.ico" type=
  "image/x-icon">
  <link rel="canonical" href=
  "https://legacy.imagemagick.org/Usage/bugs/animation_bgnd/">
  <!--[if gte IE 5.5000]><![if lt IE 7.0000]>
<script type="text/javascript" src="../../img_www/pngfix.js"></script>
<![endif]><![endif]-->
</head>
<body bgcolor="#B0C4DE">
  <h1>ImageMagick v6 Examples --<br>
  <img src="../../img_www/space.gif" width="50" height="1">
  Animation Bugs involving Coalesce and Deconstruct -- FIXED</h1>
  <div align="justify">
    <dl>
      <dt><b>Index</b></dt>
      <dt>
        <a href="../../index.html"><img src=
        "../../img_www/granitesm_left.gif" border="0" width="15"
        height="15"> ImageMagick Examples Preface and Index</a>
      </dt>
      <dt>
        <a href="../index.html"><img src=
        "../../img_www/granitesm_left.gif" border="0" width="15"
        height="15"> Known and Fixed Bugs Index</a>
      </dt>
    </dl>The GIF animation operators of IM has been problem area
    for users for a very long time. I know I have been wrestling
    with them since version 4. The following details the long time
    problems that existed at the time I myself fixed the bugs, and
    expanded the GIF animation operators, available. Sometimes you
    just have to fix things yourself. :-) This page is for
    reference for older IM users who may still have to deal with
    this bug. The examples on this page have not been re-created
    when/if the bug was fixed.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <h2>Coalesce Bugs -- Fixed IM v6.2.6-1</h2>IM has in general
    always work fine for animations that only overlays images onto
    the results of the last image output. These animations are
    typically fully opaque (no transparent pixels) and are
    generated using either a "<code><a href=
    "../../../../html/www/command-line-options.html#dispose">-dispose</a></code>"
    setting of '<code>Undefined</code>' or '<code><a href=
    "../../anim_basics/index.html#none">None</a></code>'. However
    for the other two forms of animation "<code><a href=
    "../../../../html/www/command-line-options.html#dispose">-dispose</a></code>"
    methods, '<code><a href=
    "../../anim_basics/index.html#background">Background</a></code>'
    and '<code><a href=
    "../../anim_basics/index.html#previous">Previous</a></code>',
    the "<code><a href=
    "../../../../html/www/command-line-options.html#coalesce">-coalesce</a></code>"
    function did not work properly to generate the correct look of
    the animation at each frame. The major problem with these
    methods was that pixels in the next frame generated could be
    cleared back to a transparent color, something that just
    overlaying the next frame will not achieve. The reslt was that
    the colesced animation did not have the same look as the
    original animation. For example here is a '<code><a href=
    "../../anim_basics/index.html#background">Background</a></code>'
    disposal animation, which had the worse results for
    "<code><a href=
    "../../../../html/www/command-line-options.html#coalesce">-coalesce</a></code>"
    bugs.
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr>
        <td width="100%" align="justify">
          <table border="1" cellspacing="0" cellpadding="5" width=
          "100%" bgcolor="#CCCCCC">
            <tr>
              <td>
                <pre><code never_execute_again="">
    convert -dispose none  -delay 0 \
                  -size 100x100 xc:skyblue \
                  -fill dodgerblue -draw 'circle 50,50 15,25' \
            -dispose background -delay 100 \
                  -page +5+10  balloon.gif  \
                  -page +35+30 medical.gif  \
                  -page +62+50 present.gif  \
                  -page +10+55 shading.gif  \
            -loop 0  canvas_bgnd.gif
</code> </pre>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <a href="canvas_bgnd.gif"><img src="canvas_bgnd.gif"
          width="100" height="100" align="middle" vspace="0"
          hspace="5" border="1" alt="[IM Output]"></a>
        </td>
      </tr>
    </table>Which for IM version 6.2.2 produced the following
    "<code><a href=
    "../../../../html/www/command-line-options.html#coalesce">-coalesce</a></code>"
    result.
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr>
        <td width="100%" align="justify">
          <table border="1" cellspacing="0" cellpadding="5" width=
          "100%" bgcolor="#CCCCCC">
            <tr>
              <td>
                <pre><code never_execute_again="">
    convert canvas_bgnd.gif -coalesce canvas_bgnd_coalesce_old.gif
    montage canvas_bgnd_coalesce_old.gif -tile x1 -geometry '+2+2' \
            -background none -bordercolor none canvas_bgnd_coal_old_frames.gif
</code> </pre>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <a href="canvas_bgnd_coalesce_old.gif"><img src=
          "canvas_bgnd_coalesce_old.gif" width="100" height="100"
          align="middle" vspace="0" hspace="5" border="1" alt=
          "[IM Output]"></a>
        </td>
      </tr>
    </table>
    <div align="center">
      <a href="canvas_bgnd_coal_old_frames.gif"><img src=
      "canvas_bgnd_coal_old_frames.gif" align="middle" vspace="0"
      hspace="5" border="0" alt="[IM Output]"></a>
    </div>As you can see the results was incorrect, with the
    background being cleared to the background color. In fact any
    animations involving transparency has problems such as this.
    However from IM version 6.2.6-1, "<code><a href=
    "../../../../html/www/command-line-options.html#coalesce">-coalesce</a></code>"
    now produces the correct frames, and sets the disposal methods
    for the coalesced frames so that the animated form also works
    exactly like the original animation.
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr>
        <td width="100%" align="justify">
          <table border="1" cellspacing="0" cellpadding="5" width=
          "100%" bgcolor="#CCCCCC">
            <tr>
              <td>
                <pre><code do_not_execute="">
    convert canvas_bgnd.gif -coalesce canvas_bgnd_coalesce.gif
    montage canvas_bgnd_coalesce.gif -tile x1 -geometry '+2+2' \
            -background none -bordercolor none canvas_bgnd_coal_frames.gif
</code> </pre>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <a href="canvas_bgnd_coalesce.gif"><img src=
          "canvas_bgnd_coalesce.gif" width="100" height="100"
          align="middle" vspace="0" hspace="5" border="1" alt=
          "[IM Output]"></a>
        </td>
      </tr>
    </table>
    <div align="center">
      <a href="canvas_bgnd_coal_frames.gif"><img src=
      "canvas_bgnd_coal_frames.gif" align="middle" vspace="0"
      hspace="5" border="0" alt="[IM Output]"></a>
    </div>It has taken a very long incremental testing to reach
    this point. Getting the appropriate '<code><a href=
    "../../anim_basics/index.html#background">Background</a></code>'
    disposal effects, and setting the "<code><a href=
    "../../../../html/www/command-line-options.html#dispose">-dispose</a></code>"
    method for the new coalesced animation is not a simple matter.
    All these "<code><a href=
    "../../../../html/www/command-line-options.html#coalesce">-coalesce</a></code>"
    problems were fixed in version 6.2.6-1.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <h2>Deconstruct Bug - Replacement operator IM
    v6.2.6-3</h2>Finding any "<code><a href=
    "../../../../html/www/command-line-options.html#deconstruct">-deconstruct</a></code>"
    problems is difficult unless "<code><a href=
    "../../../../html/www/command-line-options.html#coalesce">-coalesce</a></code>"
    doing the right job. However "<code><a href=
    "../../../../html/www/command-line-options.html#deconstruct">-deconstruct</a></code>"
    original purpose was to find the differences from one frame to
    another, and this is can be done without any need to look at or
    understand GIF animation "<code><a href=
    "../../../../html/www/command-line-options.html#dispose">-dispose</a></code>"
    methods. For example, given the above montage of a correctly
    coalesced '<code><a href=
    "../../anim_basics/index.html#background">Background</a></code>'
    disposal animation...
    <div align="center">
      <a href="canvas_bgnd_coal_frames.gif"><img src=
      "canvas_bgnd_coal_frames.gif" align="middle" vspace="0"
      hspace="5" border="0" alt="[IM Output]"></a>
    </div>The "<code><a href=
    "../../../../html/www/command-line-options.html#deconstruct">-deconstruct</a></code>"
    operator will generate the following frames...
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code do_not_execute="">
    convert canvas_bgnd_coalesce.gif -deconstruct canvas_bgnd_deconst.gif
    convert canvas_bgnd_deconst.gif -bordercolor none -frame 4x4+2+2 miff:- |\
      montage miff:- -tile x1 -geometry '+2+2' \
              -background none -bordercolor none canvas_bgnd_dec_frames.gif
</code> </pre>
          </td>
        </tr>
      </table><a href="canvas_bgnd_dec_frames.gif"><img src=
      "canvas_bgnd_dec_frames.gif" align="middle" vspace="0"
      hspace="5" border="0" alt="[IM Output]"></a>
    </div>The actual frame images generated by "<code><a href=
    "../../../../html/www/command-line-options.html#deconstruct">-deconstruct</a></code>"
    is correct, as they do show the rectangular area that has
    changed in the animation. And in fact using "<code><a href=
    "../../../../html/www/command-line-options.html#deconstruct">-deconstruct</a></code>"
    on animations which only overlay the changes from one frame to
    the next will work fine for a disposal method of
    '<code><a href="../../anim_basics/index.html#none">None</a></code>'.
    <a href="canvas_bgnd_deconst.gif"><img src=
    "canvas_bgnd_deconst.gif" width="100" height="100" align=
    "right" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
    However as you can see from the animation of 'Deconstructed'
    images that were generated (see right), they do <b>not</b> work
    correctly in a GIF animation.
    <div align="center">
      <b>This problem will never be corrected!</b>
    </div>This problem was fixed in IM v6.2.6-3, by providing a new
    "<code><a href=
    "../../../../html/www/command-line-options.html#layers">-layers</a>
    <a href=
    "../../anim_basics/index.html#optframe">OptimizeFrame</a></code>"
    method, that not only deconstructs the image but trys to find
    the best "<code><a href=
    "../../../../html/www/command-line-options.html#dispose">-dispose</a></code>"
    method to frame optimize the animation correctly.
  </div>
  <hr>
  <!-- ---------------------------------------------------------------- -->
  <address>
    Created: 24 January 2006<br>
    Updated: 10 March 2006<br>
    Author: <a href=
    "https://antofthy.gitlab.io/anthony.html">Anthony Thyssen</a>,
    &lt;Anthony.Thyssen@gmail.com&gt;<br>
    Examples Generated with: <img src="version.gif" align=
    "absmiddle" alt="[version image]"><br>
    URL:
    <code>https://legacy.imagemagick.org/Usage/bugs/animation_bgnd/</code>
  </address>
</body>
</html>
