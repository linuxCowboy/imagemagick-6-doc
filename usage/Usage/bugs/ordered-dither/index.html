<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 for Linux version 5.6.0">
  <meta charset="utf-8">
  <meta name="viewport" content=
  "width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../../../html/www/css/magick.css">
  <title>Ordered Dither Upgrade -- IM v6 Examples</title>
  <link rel="icon" href="../../img_www/favicon.ico" type=
  "image/x-icon">
  <link rel="shortcut" href="../../img_www/favicon.ico" type=
  "image/x-icon">
  <link rel="canonical" href=
  "https://legacy.imagemagick.org/Usage/bugs/ordered-dither/">
  <!--[if gte IE 5.5000]><![if lt IE 7.0000]>
<script type="text/javascript" src="../../img_www/pngfix.js"></script>
<![endif]><![endif]-->
</head>
<body bgcolor="#B0C4DE">
  <h1>ImageMagick v6 Examples --<br>
  <img src="../../img_www/space.gif" width="50" height="1"> Ordered
  Dither Upgrade</h1>
  <div align="justify">
    <dl>
      <dt><b>Index</b></dt>
      <dt>
        <a href="../../index.html"><img src=
        "../../img_www/granitesm_left.gif" border="0" width="15"
        height="15"> ImageMagick Examples Preface and Index</a>
      </dt>
      <dt>
        <a href="../index.html"><img src=
        "../../img_www/granitesm_left.gif" border="0" width="15"
        height="15"> Known and Fixed Bugs Index</a>
      </dt>
    </dl>The following is a demonstration before and after results
    and IM Examples development examples of a new or exapnded
    aspect of ImageMagick. During the creation of the IM Examples
    for <a href="../../quantize/index.html">Quantization and
    Dithering</a> I saw an oppertunity to expand the ordered dither
    functionality to not only provide more ordered dither patterns,
    but also expand it to provide an ordered dithered posterization
    functionality. That is allow not only bitmap dithering, but
    dithering between multiple color levels as per the
    "<code><a href=
    "../../../../html/www/command-line-options.html#posterize">-posterize</a></code>"
    operator. See <a href=
    "../../quantize/index.html#posterize">Posterize, recolor using
    primary colors</a> for examples.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <h2>Original Ordered Dither Threshold Maps</h2><i>This is
    section is a reference and will not be updated.</i> This is
    what the IM "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    operator provided before the expandion of this operators
    functionality.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code do_not_execute="">
    convert logo: -resize 40% -crop 100x100+105+50\!   logo.png
    convert logo.png    -ordered-dither 2x2    logo_2x2.gif
    convert logo.png    -ordered-dither 3x3    logo_3x3.gif
    convert logo.png    -ordered-dither 4x4    logo_4x4.gif
</code></pre>
          </td>
        </tr>
      </table><a href="logo.png"><img src="logo.png" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <img src="../../img_www/right.gif" width="20" height="20"
      align="middle" alt="==&gt;"> <a href="logo_2x2.gif"><img src=
      "logo_2x2.gif" align="middle" vspace="5" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="logo_3x3.gif"><img src=
      "logo_3x3.gif" align="middle" vspace="5" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="logo_4x4.gif"><img src=
      "logo_4x4.gif" align="middle" vspace="5" hspace="5" border=
      "1" alt="[IM Output]"></a>
    </div>Note that ordered dither was able to, by default so a
    level 2 posterization of images. This will be the last time I
    look at this. Notice that it only provided these three ordered
    dither patterns, and these patterns had to be specified as
    numbers, representing the patterns tile size. Lets look at
    these patterns using gradients.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code do_not_execute="">
    convert gradient:'[640x1]' -scale 640x30\! -negate    gradient.png
    convert gradient.png  -ordered-dither 2x2  orig_2x2.gif
    convert gradient.png  -ordered-dither 3x3  orig_3x3.gif
    convert gradient.png  -ordered-dither 4x4  orig_4x4.gif
    convert gradient.png  -ordered-dither 8x8  orig_8x8.gif
</code></pre>
          </td>
        </tr>
      </table><a href="orig_2x2.gif"><img src="orig_2x2.gif" align=
      "middle" vspace="5" hspace="5" border="1" alt=
      "[IM Output]"></a> <a href="orig_3x3.gif"><img src=
      "orig_3x3.gif" align="middle" vspace="0" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="orig_4x4.gif"><img src=
      "orig_4x4.gif" align="middle" vspace="5" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="orig_8x8.gif"><img src=
      "orig_8x8.gif" align="middle" vspace="5" hspace="5" border=
      "1" alt="[IM Output]"></a>
    </div>The extra '<code>8x8</code>' ordered dither pattern was
    an existing ordered dither function that was only linked into
    the "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    operator with IM v6.2.9-2, under my suggestion. In version IM
    v6.2.8-6 some digital-halftone dither patterns was added by
    Glenn Randers-Pehrson.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code do_not_execute="">
    convert gradient.png  -ordered-dither 2x1  orig_2x1.gif
    convert gradient.png  -ordered-dither 4x1  orig_4x1.gif
    convert gradient.png  -ordered-dither 6x1  orig_6x1.gif
    convert gradient.png  -ordered-dither 8x1  orig_8x1.gif
</code></pre>
          </td>
        </tr>
      </table><a href="orig_2x1.gif"><img src="orig_2x1.gif" align=
      "middle" vspace="5" hspace="5" border="1" alt=
      "[IM Output]"></a> <a href="orig_4x1.gif"><img src=
      "orig_4x1.gif" align="middle" vspace="0" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="orig_6x1.gif"><img src=
      "orig_6x1.gif" align="middle" vspace="5" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="orig_8x1.gif"><img src=
      "orig_8x1.gif" align="middle" vspace="0" hspace="5" border=
      "1" alt="[IM Output]"></a>
    </div>Note the 'hack'-like nature using a '<code>x1</code>'
    number to allow the addition of these dithering patterns. Also
    note that at this time "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    and "<code><a href=
    "../../../../html/www/command-line-options.html#random-dither">-random-dither</a></code>"
    operators were aliases for each other, which is why this
    restriction existed. But it also created a horrible 'fall-back'
    situation, in that if the arguments for "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    was wrong, IM would do a "<code><a href=
    "../../../../html/www/command-line-options.html#random-dither">-random-dither</a></code>"
    using a very bad set of argument, rather than give the user an
    error.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <h2>Ordered Dither Threshold Maps Expansion (and
    naming)</h2>From IM v6.2.9-7, the above changed, to allow the
    use of more symbolic selection of the ordered dither threshold
    maps, with IM returning an error if no map was selected rather
    than falling back to the disasterious "<code><a href=
    "../../../../html/www/command-line-options.html#random-dither">-random-dither</a></code>"
    operator. First of all, all the threshold maps used for the
    ordered dither patterns were checked and updated to produce a
    better result for the specified style. For example compare
    these new "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    threshold map results...
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    convert logo.png    -ordered-dither o3x3    logo_o3x3.gif
    convert logo.png    -ordered-dither o4x4    logo_o4x4.gif
</code></pre>
          </td>
        </tr>
      </table><a href="logo_o3x3.gif"><img src="logo_o3x3.gif"
      align="middle" vspace="5" hspace="25" border="1" alt=
      "[IM Output]"></a> <a href="logo_o4x4.gif"><img src=
      "logo_o4x4.gif" align="middle" vspace="5" hspace="25" border=
      "1" alt="[IM Output]"></a>
    </div>...to what the previous threshold maps produced...
    <div align="center">
      <a href="logo_3x3.gif"><img src="logo_3x3.gif" align="middle"
      vspace="5" hspace="25" border="1" alt="[IM Output]"></a>
      <a href="logo_4x4.gif"><img src="logo_4x4.gif" align="middle"
      vspace="5" hspace="25" border="1" alt="[IM Output]"></a>
    </div>As you can see the re-developed and checked threshold
    maps produce a distictly better diffused pixel dither pattern.
    And here is the new expanded set of built-in ordered dither
    threshold map arguments, and the new names for selecting the
    threshold map to use.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    # Threshold Non-Dither / Minimal Checkerboard Dither
    convert gradient.png   -ordered-dither threshold  od_threshold.gif
    convert gradient.png   -ordered-dither checks     od_checks.gif
    # Diffused Pixel Dither
    convert gradient.png   -ordered-dither o2x2       od_o2x2.gif
    convert gradient.png   -ordered-dither o3x3       od_o3x3.gif
    convert gradient.png   -ordered-dither o4x4       od_o4x4.gif
    convert gradient.png   -ordered-dither o8x8       od_o8x8.gif
    # Halftone Screen (45 degree angle)
    convert gradient.png   -ordered-dither h4x4a      od_h4x4a.gif
    convert gradient.png   -ordered-dither h6x6a      od_h6x6a.gif
    convert gradient.png   -ordered-dither h8x8a      od_h8x8a.gif
    # Halftone Screen (orthogonal)
    convert gradient.png   -ordered-dither h4x4o      od_h4x4o.gif
    convert gradient.png   -ordered-dither h6x6o      od_h6x6o.gif
    convert gradient.png   -ordered-dither h8x8o      od_h8x8o.gif
    convert gradient.png   -ordered-dither h16x16o    od_h16x16o.gif
</code></pre>
          </td>
        </tr>
      </table><a href="od_threshold.gif"><img src=
      "od_threshold.gif" align="middle" vspace="5" hspace="5"
      border="1" alt="[IM Output]"></a> <a href=
      "od_checks.gif"><img src="od_checks.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <hr width="20%" align="center">
      <a href="od_o2x2.gif"><img src="od_o2x2.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_o3x3.gif"><img src="od_o3x3.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_o4x4.gif"><img src="od_o4x4.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_o8x8.gif"><img src="od_o8x8.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <hr width="20%" align="center">
      <a href="od_h4x4a.gif"><img src="od_h4x4a.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_h6x6a.gif"><img src="od_h6x6a.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_h8x8a.gif"><img src="od_h8x8a.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <hr width="20%" align="center">
      <a href="od_h4x4o.gif"><img src="od_h4x4o.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_h6x6o.gif"><img src="od_h6x6o.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_h8x8o.gif"><img src="od_h8x8o.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_h16x16o.gif"><img src="od_h16x16o.gif" align=
      "middle" vspace="5" hspace="5" border="1" alt=
      "[IM Output]"></a>
    </div>That is a total of 13 different types of threshold maps.
    Internally the code was designed to allow simple addition of
    more such maps in the future, and the development of the use of
    XML data file to read in such maps in a later stage. Note the
    "<code>checks</code>" used to be called "<code>2x1</code>", as
    a halftone 2x2 pattern, however it is more than that. It
    represents the most minimal dither pattern posible, for all
    ordered dither patterns, one that only adds a single dither
    pattern between any two colors. The "<code>threshold</code>"
    pattern is supplied as an equivelent to using a undithered
    "<code><a href=
    "../../../../html/www/command-line-options.html#posterize">-posterize</a></code>"
    operator, as well as a test map on the posterization aspects of
    the new "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    function. (See next section) As part of backward compatibility,
    all the old '<code><i>{number}</i>x<i>{number}</i></code>'
    arguments have been made aliases to the appropriate 'named'
    threshold map above. They are now depreciated, but will always
    remain.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <a name="posterize" id="posterize"></a>
    <h2>Posterized Ordered Dither Expansion</h2>The above
    consolidation of "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    code and the addition of the extra threshold mappings was not
    the primary purpose of the re-development of the operator. With
    some initial 'proof of concept' work using the "<code><a href=
    "../../../../html/www/command-line-options.html#fx">-fx</a></code>"
    operator (see below), I wanted to provide a ordered dithering
    between multiple levels of colors (as per the "<code><a href=
    "../../../../html/www/command-line-options.html#posterize">-posterize</a></code>").
    WHY? Because then you can generate a more deterministic
    dithering of images than you can achieve with 'error correction
    dithering'. This is especially important for color reductions
    involving animations as you will not get problems from color
    differences between frames. The posterization level is added to
    "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    argument using commas, making this addition backward compatible
    with previous usage of the operator. For example 'checks,6'
    will use a classic "web-safe" color map (see the "netscape:"
    built-in), but add one extra pseudo-level of color dithering
    the 'checks' dither map between each level. In other words even
    though only 6 levels of color per channel is being used
    (producing 6^3 or 216 colors) the single dither pattern between
    levels increases the dither to and effective 11 levels
    (producing and effective 11^3 or 1331 colors). In this I plan
    to implement the extra levels with the following proprieties.
    <ul>
      <li>What channels are operated on is controlled by the
      "-channels" setting.</li>
      <li>A single number is for all channels. EG: '6' for the
      "web-safe colormap".</li>
      <li>Multiple numbers allows you to use different level counts
      for each channel. EG: '8,8,4' will implement a '332' ordered
      dithered colormap.</li>
      <li>If no numbers are given, fall back to a 2 level bitmap
      dither.</li>
      <li>A value of zero disables posterization of that color
      channel.</li>
    </ul>For example here is the same gray scale gradient first
    dithered using a 6 grey levels.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    # dithering between 6 grey levels
    convert gradient.png   -ordered-dither threshold,6  od_threshold_6.gif
    convert gradient.png   -ordered-dither checks,6     od_checks_6.gif
    convert gradient.png   -ordered-dither o2x2,6       od_o2x2_6.gif
    convert gradient.png   -ordered-dither o4x4,6       od_o4x4_6.gif
    convert gradient.png   -ordered-dither o8x8,6       od_o8x8_6.gif
</code></pre>
          </td>
        </tr>
      </table><a href="od_threshold_6.gif"><img src=
      "od_threshold_6.gif" align="middle" vspace="2" hspace="5"
      border="1" alt="[IM Output]"></a> <a href=
      "od_checks_6.gif"><img src="od_checks_6.gif" align="middle"
      vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
      <a href="od_o2x2_6.gif"><img src="od_o2x2_6.gif" align=
      "middle" vspace="2" hspace="5" border="1" alt=
      "[IM Output]"></a> <a href="od_o4x4_6.gif"><img src=
      "od_o4x4_6.gif" align="middle" vspace="2" hspace="5" border=
      "1" alt="[IM Output]"></a> <a href="od_o8x8_6.gif"><img src=
      "od_o8x8_6.gif" align="middle" vspace="2" hspace="5" border=
      "1" alt="[IM Output]"></a>
    </div>Compare that to the original gradient...
    <div align="center">
      <a href="gradient.png"><img src="gradient.png" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
    </div>As you can see even though only 6 colors are used, with
    ordered dithering you increase the effective number of colors
    used to define the gradient, to a point where you can be hard
    pressed to notice just how few colors were used! Not only can
    you define the number of posterization levels for all channels,
    but you can specify the levels for each channel (as specified
    in "<code><a href=
    "../../../../html/www/command-line-options.html#channels">-channels</a></code>".
    For example here we dithered the gradient using a special 332
    color map (8 levels or red and green, 4 of blue) which defines
    a total of 256 colors.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    convert gradient.png   -ordered-dither o8x8,8,8,4   od_o8x8_884.gif
</code></pre>
          </td>
        </tr>
      </table><a href="od_o8x8_884.gif"><img src="od_o8x8_884.gif"
      align="middle" vspace="5" hspace="5" border="1" alt=
      "[IM Output]"></a>
    </div>Because of the different number of color levels per
    channel, the above image is not made up of pure grey colors,
    but includes some bluish and yellowish pixels which cancels
    each other out to produce extra levels of greys. Now compare a
    'error correction dithered' posterization, with an 'ordered
    dithered' posterization of the IM logo at level 2, and level 6.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    convert logo.png   -posterize 2             logo_posterize_2.gif
    convert logo.png   -ordered-dither o8x8     logo_o8x8_2.gif
    convert logo.png   -posterize 6             logo_posterize_6.gif
    convert logo.png   -ordered-dither o8x8,6   logo_o8x8_6.gif
</code></pre>
          </td>
        </tr>
      </table><a href="logo_posterize_2.gif"><img src=
      "logo_posterize_2.gif" align="middle" vspace="5" hspace="5"
      border="1" alt="[IM Output]"></a> <a href=
      "logo_o8x8_2.gif"><img src="logo_o8x8_2.gif" align="middle"
      vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
      &nbsp; &nbsp; &nbsp; &nbsp; <a href=
      "logo_posterize_6.gif"><img src="logo_posterize_6.gif" align=
      "middle" vspace="5" hspace="5" border="1" alt=
      "[IM Output]"></a> <a href="logo_o8x8_6.gif"><img src=
      "logo_o8x8_6.gif" align="middle" vspace="5" hspace="5"
      border="1" alt="[IM Output]"></a>
    </div>Each set of images use the same set of colors, the first
    pair using the simple threshold set of 8 colors, with the
    second using the 6 level 'web-safe' color map. The first image
    in each pair is pseudo-randomly 'error correction' dithered,
    the second is ordered dithered. That means if a small change
    occurs the first will have almost the whole pattern of dithered
    colors within the image will change, while the second will only
    be modified wherever it was actually changed. In other words an
    ordered dithered posterization is much better for animations,
    that rely on finding the areas of change in images to reduce
    the overall animation size. The 'error correction dithered'
    version however is generally regarded as better as it is more
    'correct' color wise, and there is less patterns to attract the
    eye. Also at this time you can not use ordered dithering
    between a random set of colors as you can with an 'error
    correction dither', but only between mathematically determined
    'posterized' colors.
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr valign="bottom">
        <td width="100%" align="justify">
          Here is the logo ordered dithered against a '332'
          colormap
          <table border="1" cellspacing="0" cellpadding="5" width=
          "100%" bgcolor="#CCCCCC">
            <tr>
              <td>
                <pre><code execute="">
    convert logo.png   -ordered-dither o8x8,8,8,4     logo_o8x8_332.gif
</code></pre>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <a href="logo_o8x8_332.gif"><img src="logo_o8x8_332.gif"
          align="middle" vspace="0" hspace="5" border="1" alt=
          "[IM Output]"></a>
        </td>
      </tr>
    </table>The '332' colormap (8 levels of red and green, 4 levels
    of blue) is regarded as probably the best posterize colormap
    for a 256 color limit image. The off difference in channel
    levels producing a slightly better shading of colors for this
    cartoon like image. Unfortunately this is not currently
    reproducible using the error correction dithered
    "<code><a href="../../../../html/www/command-line-options.html#posterize">-posterize</a></code>"
    operator. It was to produce this color map that the expansion
    of the "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    operator, included the ability to specify separate levels for
    each color channel.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <h2>XML data source for threshold maps</h2>This was a final
    addition to the Ordered Dither Upgrade, and combined with a
    revisement of all the XML data handling within IM by Cristy.
    With this development you can now use a "<code><a href=
    "../../../../html/www/command-line-options.html#list">-list</a>
    threshold</code>" command to see exactly what maps are
    available to the "<code><a href=
    "../../../../html/www/command-line-options.html#ordered-dither">-ordered-dither</a></code>"
    operator. as well as use personal "<code>threshold.xml</code>"
    data files to define your own maps.
    <hr>
    <!-- ---------------------------------------------------------------- -->
    <a name="diy" id="diy"></a>
    <h2>DIY New Othered-Dither Replacement</h2><i>This is provided
    as a reference to the source and prototyping of the new
    posterized form of ordered dither functionality that was shown
    above.</i> As part of using ImageMagick for my own images, I
    wanted to be able to design and use my own ordered dither
    patterns. As such I figured out a equivalent ordered dither
    method using the extremely slow "<code><a href=
    "../../../../html/www/command-line-options.html#fx">-fx</a></code>"
    operator. For example (repeat of <a href=
    "../../quantize/index.html#diy_horizontal">DIY Horizontal
    Dither</a>)... Here I created another set of dither pattern
    images, specifically to produce a interesting shadow shading
    effect.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    montage dpat_hlines.gif   -filter box   -geometry 30x20+5+0 \
            -tile x1 -background none  -frame 3   dpat_hlines_images.gif
    convert gradient:'[600x1]' -scale 600x24\! -negate \
            dpat_hlines.gif   -virtual-pixel tile  -fx 'u[floor(13*u)+1]' \
            dpat_hlines_gradient.gif
</code></pre>
          </td>
        </tr>
      </table><a href="dpat_hlines_images.gif"><img src=
      "dpat_hlines_images.gif" align="middle" vspace="2" hspace="5"
      border="0" alt="[IM Output]"></a><br>
      <a href="dpat_hlines_gradient.gif"><img src=
      "dpat_hlines_gradient.gif" align="middle" vspace="2" hspace=
      "5" border="1" alt="[IM Output]"></a>
    </div>And here I apply it to generate a shadow pattern.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    convert -size 120x55 xc:white  -draw 'fill #777 ellipse 50,43 30,5 0,360' \
            -motion-blur 0x15+180   -blur 0x2      sphere_shadow.png
    convert sphere_shadow.png \
            dpat_hlines.gif   -virtual-pixel tile  -fx 'u[floor(13*u)+1]' \
            sphere_shadow_dither.gif
    convert sphere_shadow_dither.gif   -fill red  -stroke firebrick \
            -draw 'circle 35,25 35,5'     sphere_shadow_hlines.gif
</code></pre>
          </td>
        </tr>
      </table><a href="sphere_shadow.png"><img src=
      "sphere_shadow.png" align="middle" vspace="2" hspace="5"
      border="1" alt="[IM Output]"></a> <img src=
      "../../img_www/right.gif" width="20" height="20" align=
      "middle" alt="==&gt;"> <a href=
      "sphere_shadow_dither.gif"><img src=
      "sphere_shadow_dither.gif" align="middle" vspace="2" hspace=
      "5" border="1" alt="[IM Output]"></a> <img src=
      "../../img_www/right.gif" width="20" height="20" align=
      "middle" alt="==&gt;"> <a href=
      "sphere_shadow_hlines.gif"><img src=
      "sphere_shadow_hlines.gif" align="middle" vspace="2" hspace=
      "5" border="1" alt="[IM Output]"></a>
    </div>Now I converted Multi-Image Dither patterns, into and
    ordered dither threshold map. Though this only works properly
    for complete sets of ordered dithered images.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    montage dpat_o2x2.gif   -filter box   -geometry 30x30+5+0 \
            -tile x1 -background none  -frame 3   dpat_o2x2_images.gif
    convert dpat_o2x2.gif  -delete 0 +append \
            \( gradient:'[6x1]' -chop 1x0 -flop -chop 1x0 -scale 200% \) \
            +matte +swap -compose CopyOpacity -composite \
            -background none -crop 2x2 +repage -compose DstOver -flatten \
            +matte dmap_o2x2.png
    montage dmap_o2x2.png -filter box -geometry 30x30 -frame 3 dmap_o2x2_mag.png
</code></pre>
          </td>
        </tr>
      </table><a href=
      "http://legacy.imagemagick.org/Usage/bugs/ordered-dither/dpat_o2x2.gif"><img src="dpat_o2x2_images.gif"
      align="middle" vspace="2" hspace="5" border="0" alt=
      "[IM Output]"></a> <img src="../../img_www/right.gif" width=
      "20" height="20" align="middle" alt="==&gt;"> <a href=
      "dmap_o2x2.png"><img src="dmap_o2x2_mag.png" align="middle"
      vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
    </div>Which can be applied using "<code><a href=
    "../../../../html/www/command-line-options.html#fx">-fx</a></code>".
    Now we can dither our images using, just a single image, and a
    much simpler threshold comparison for each pixel rather than
    multiple images.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    convert gradient:'[600x1]' -scale 600x24\! -negate \
            dmap_o2x2.png   -virtual-pixel tile  -fx 'u&gt;=v' \
            dmap_o2x2_gradient.gif
</code></pre>
          </td>
        </tr>
      </table><a href="dmap_o2x2.png"><img src="dmap_o2x2_mag.png"
      width="20" height="20" align="middle" vspace="2" hspace="2"
      border="1" alt="[IM Output]"></a> <img src=
      "../../img_www/right.gif" width="20" height="20" align=
      "middle" alt="==&gt;"> <a href=
      "dmap_o2x2_gradient.gif"><img src="dmap_o2x2_gradient.gif"
      align="middle" vspace="2" hspace="2" border="1" alt=
      "[IM Output]"></a>
    </div>And an example of applying this map.
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr valign="top">
        <td width="100%" align="justify">
          <table border="1" cellspacing="0" cellpadding="5" width=
          "100%" bgcolor="#CCCCCC">
            <tr>
              <td>
                <pre><code execute="">
    convert logo.png \
            dmap_o2x2.png   -virtual-pixel tile  -fx 'u&gt;=v' \
            diy_map_o2x2.gif
</code></pre>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <a href="diy_map_o2x2.gif"><img src="diy_map_o2x2.gif"
          align="middle" vspace="0" hspace="5" border="1" alt=
          "[IM Output]"></a>
        </td>
      </tr>
    </table>These were then expanded into posterized forms.
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    montage dpat_o2x2x6.gif   -filter box   -geometry 20x20+3+3 \
            -tile x1 -background none  -frame 2   dpat_o2x2x6_images.gif
    convert gradient:'[600x1]' -scale 600x20\! -negate \
            dpat_o2x2x6.gif   -virtual-pixel tile  -fx 'u[floor(21*u)+1]' \
            dpat_o2x2x6_gradient.gif
</code></pre>
          </td>
        </tr>
      </table><a href=
      "http://legacy.imagemagick.org/Usage/bugs/ordered-dither/dpat_o2x2x6.gif"><img src="dpat_o2x2x6_images.gif"
      align="middle" vspace="2" hspace="5" border="0" alt=
      "[IM Output]"></a><br>
      <a href="dpat_o2x2x6_gradient.gif"><img src=
      "dpat_o2x2x6_gradient.gif" align="middle" vspace="2" hspace=
      "5" border="1" alt="[IM Output]"></a>
    </div>
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr valign="bottom">
        <td width="100%" align="justify">
          And here I apply it to each color channel of IM logo test
          image.
          <table border="1" cellspacing="0" cellpadding="5" width=
          "100%" bgcolor="#CCCCCC">
            <tr>
              <td>
                <pre><code execute="">
    convert logo.png \
            dpat_o2x2x6.gif   -virtual-pixel tile  -fx 'u[floor(21*u)+1]' \
            diy_ordered_2x2x6.gif
</code></pre>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <a href="diy_ordered_2x2x6.gif"><img src=
          "diy_ordered_2x2x6.gif" align="middle" vspace="0" hspace=
          "5" border="1" alt="[IM Output]"></a>
        </td>
      </tr>
    </table>And finally I created a posterized form of ordered
    dither using a single binary threshold map. <!--
Debugging Commands for multi-level
    # l = level                   p = levels in threhold map
    # g = grey-scale increment    t = grey-levels from threshold map
    # d = total number of grey-levels used in final image
    # dither set count :  floor(v*$d/$p)
    # dither set size  :  $p/$d
    l=6; g=`expr $l - 1`; \
    p=`convert dmap_o2x2.png -unique-colors -format %w info:`; \
    t=`expr $p + 1`;  d=`expr $g \* $p + 1`; \
    echo "l=$l g=$g p=$p t=$t d=$d"; \
    convert gradient:'[600x1]' -scale 600x20\! -negate \
            dmap_o2x2.png   -virtual-pixel tile \
            -fx "(v&lt;(u*$d-floor(u*$d/$p)*$p)/$t)" \
            dpat_o2x2x3_gradient_2.gif; \
    convert gradient:'[600x1]' -scale 600x20\! -negate \
            -fx "(0+floor(u*$d/$p))/$g" \
            dpat_o2x2x3_gradient_3.gif; \
    convert gradient:'[600x1]' -scale 600x20\! -negate \
            -fx "(1+floor(u*$d/$p))/$g" \
            dpat_o2x2x3_gradient_4.gif; \
    convert gradient:'[600x1]' -scale 600x20\! -negate \
            dmap_o2x2.png   -virtual-pixel tile \
            -fx "((v&lt;(u*$d-floor(u*$d/$p)*$p)/$t)+floor(u*$d/$p))/$g" \
            dpat_o2x2x3_gradient.gif
-->
    <div align="center">
      <table border="1" cellspacing="0" cellpadding="5" width="80%"
      bgcolor="#CCCCCC">
        <tr>
          <td>
            <pre><code execute="">
    map=dmap_o2x2.png;    levels=6; \
    g=`expr $levels - 1`; \
    p=`convert $map -unique-colors -format %w info:`; \
    t=`expr $p + 1`;  d=`expr $g \* $p + 1`; \
    convert gradient:'[600x1]' -scale 600x20\! -negate \
            -virtual-pixel tile    $map  \
            -fx "((((u*$d-floor(u*$d/$p)*$p)/$t)&gt;=v)+floor(u*$d/$p))/$g" \
            diy_o2x2_l6_gradient.gif
</code></pre>
          </td>
        </tr>
      </table><a href="dmap_o2x2.png"><img src="dmap_o2x2_mag.png"
      width="20" height="20" align="middle" vspace="2" hspace="2"
      border="1" alt="[IM Output]"></a> <img src=
      "../../img_www/right.gif" width="20" height="20" align=
      "middle" alt="==&gt;"> <a href=
      "diy_o2x2_l6_gradient.gif"><img src=
      "diy_o2x2_l6_gradient.gif" align="middle" vspace="2" hspace=
      "2" border="1" alt="[IM Output]"></a>
    </div>It is the mathematics developed for this final,
    posterization ordered dither from a single threshold map, that
    was encoded to produce the new
    <code>OrderedPosterizeImage()</code>, function defined above.
  </div>
  <hr>
  <!-- ---------------------------------------------------------------- -->
  <address>
    Created: 18 September 2006 (from 'quantize' example page)<br>
    Updated: 24 September 2006<br>
    Author: <a href=
    "https://antofthy.gitlab.io/anthony.html">Anthony Thyssen</a>,
    &lt;Anthony.Thyssen@gmail.com&gt;<br>
    Examples Generated with: <img src="version.gif" align=
    "absmiddle" alt="[version image]"><br>
    URL:
    <code>https://legacy.imagemagick.org/Usage/bug/ordered-dither/</code>
  </address>
</body>
</html>
